{% assign categories_max = 0 %}
{% for category in site.categories %}
  {% if category[1].size > categories_max %}
    {% assign categories_max = category[1].size %}
  {% endif %}
{% endfor %}

<nav class="menu-layer">
  <h2>Primary links</h2>
  <ul role="menu" aria-labelledby="open-nav">
    {%- for link in site.data.navigation.main -%}
    {%- if link.url contains '://' -%}
    {%- assign url = link.url -%}
    {%- else -%}
    {%- assign url = link.url | relative_url -%}
    {%- endif -%}
    <li>
      <a href="{{ url }}" {% if link.description %}title="{{ link.description }}" {% endif %}>{{ link.title }}</a>
    </li>
    {%- endfor -%}
  </ul>

  <h2>Categories</h2>
  <ul role="menu" aria-labelledby="open-nav">
    {% for i in (1..categories_max) reversed %}
    {% for category in site.categories %}
    {% if category[1].size == i %}
    <li>
      <a href="#{{ category[0] | slugify }}">{{ category[0] }}</a>
    </li>
    {% endif %}
    {% endfor %}
    {% endfor %}
  </ul>

  <h2>etc.</h2>
  <h3>Important Posts</h3>
  <ul role="menu" aria-labelledby="open-nav">
    {% for post in site.posts limit:4 %}
    {% if post.important %}
    <li>
      <a href="{{ post.url }}">{{ post.title }}</a>
    </li>
    {% endif %}
    {% endfor %}
  </ul>
  
  <button type="button" class="close-nav" title="메뉴 닫기">
    <span aria-hidden="true">X</span>
  </button>
</nav>